# From 《大型网站技术架构》

# 第 2 篇 架构

# 一.瞬时响应 - 高性能架构

性能优化的目的: 

1. 改善用户体验的响应时间
2. 提高系统吞吐量
3. 对大限度利用系统资源

## 网站性能测试

性能测试是性能优化的前提和基础,  也是性能优化结果的检查和度量标准.

### 不同视角下的网站性能

针对不同视角下的网站性能,  采取对应的解决方案.

a.用户视角的性能

- 用户在浏览器上的直观感受

b.开发人员视角的性能

- 应用程序本身及相关子系统的性能

c.运维人员视角的性能

- 基础设施性能和资源利用率: 网络质量、网络资源利用率、服务器质量、服务器资源利用率

### 性能测试指标

1. 响应时间

2. 并发数

3. 吞吐量：请求数/秒, 页面数/秒, 访问人数/天,  TPS (每秒事务数),  HPS (每秒http请求数),  QPS (每秒查询数)

   ```
   吞吐量的描述指标有:
   	请求数/秒, 页面数/秒, 访问人数/天,  TPS (每秒事务数),  HPS (每秒http请求数),  QPS (每秒查询数)
   并发数与吞吐量的变化关系:
   	在系统并发数增加过程中: 
   	1.系统资源消耗增大, 系统吞吐量逐渐增加, 达到一个极限后, 随着并发数增加而下降, 达到系统崩溃点后, 系统资源耗尽, 吞吐量为0.
   	2.响应时间先小幅上升, 到达吞吐量极限后, 快速上升, 到达系统崩溃点后, 系统失去响应.
   ```

4. 性能计数器

   ```
   性能计数器是指描述服务器或操作系统性能的一些性能指标:
   1.System load (系统负载)
   2.对象与线程数
   3.内存使用
   4.CPU使用
   5.磁盘与网络I/O
   
   这些指标也是系统监控的重要参数.
   ```



### 性能测试方法

性能测试是一个总称, 具体细分为:

> 性能测试是一个不断对系统增加访问压力，以获得系统性能指标、最大负载能力、最大承压能力的过程。

1. 性能测试

   ```
   以系统设计初期规划的性能指标为预期目标, 对系统不断施压, 验证系统在资源可接受范围内, 是否能达到预期.
   ```

2. 负载测试

   ```
   对系统不断施加并发请求, 以增加系统压力, 直到系统的某项或多项性能指标达到安全临界值, 此时继续施压, 系统的处理能力不但不能提高, 反而会下降.
   ```

3. 压力测试

   ```
   超过安全负载的情况下, 对系统继续施压, 直到系统崩溃或不能再处理任何请求, 以此获得系统最大承压能力.
   ```

4. 稳定性测试

   ```
   被测系统在特定硬件、软件和网络环境下，给系统增加一定业务压力，使系统运行较长一段时间，以此检测系统是否稳定。
   稳定性测试也应不均匀地对系统施压。
   ```



### 性能测试曲线

<img src=".\images\性能测试曲线.png" alt="性能测试曲线" style="zoom:80%;" />



### 响应时间曲线

<img src=".\images\并发用户访问响应时间曲线.png" alt="并发用户访问响应时间曲线" style="zoom:80%;" />



### 性能测试报告

简单示例

| 并发数 | 响应时间(ms) | TPS  | 错误率(%) | Load | 内存(GB) | 备注     |
| ------ | ------------ | ---- | --------- | ---- | -------- | -------- |
| 10     | 500          | 20   | 0         | 5    | 8        | 性能测试 |
| 20     | 800          | 30   | 0         | 10   | 10       | 性能测试 |
| 30     | 1000         | 40   | 2         | 15   | 14       | 性能测试 |
| 40     | 1200         | 45   | 20        | 30   | 16       | 负载测试 |
| 60     | 2000         | 30   | 40        | 50   | 16       | 压力测试 |
| 80     | 超时         | 0    | 100       | 不详 | 不详     | 压力测试 |



### 性能优化策略





## Web前端性能优化

## 应用服务器性能优化

## 存储性能优化



# 二.万无一失 - 高可用架构

可用性度量与考核

高可用架构

高可用应用

高可用服务

高可用网站的软件质量保证

网站运行监控

# 三.永无止境 - 伸缩性架构

# 四.随需应变 - 可扩展架构

# 五.固若金汤 - 安全架构







